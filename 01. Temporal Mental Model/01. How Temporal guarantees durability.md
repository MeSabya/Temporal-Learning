## Why replay is necessary and how Temporal guarantees durability. ..explain with an example ...

### Why Replay Is Necessary Because:

- Workers crash
- Pods restart
- Deployments happen
- Machines die
- Memory is not durable

### Durability 

Temporal durability comes from 3 guarantees

#### Guarantee 1: History is immutable and durable

- Stored in DB
- Append-only
- Survives crashes

#### Guarantee 2: Workflow code is deterministic

- Same history → same execution
- Replay produces identical decisions
- If not → Temporal fails fast

#### Guarantee 3: Activities are side-effect boundaries

- Activities do real-world work
- Results are recorded
- Never re-executed unless retrying
- Concrete Example (Step by Step)
- Business Workflow

### Example
“Place order → charge payment → send confirmation”

```golang
func ChargeCustomer(ctx context.Context, orderID string) error {
	fmt.Println("Charging customer for order:", orderID)
	time.Sleep(2 * time.Second)
	return nil
}

/*func SendConfirmation(ctx context.Context, orderID string) error {
   exit(1)
}
```

#### What Temporal stores (History)

Temporal does NOT store variables.
It stores events:

- WorkflowStarted
- ActivityScheduled(ChargePayment)
- ActivityCompleted(ChargePayment)
- ActivityScheduled(SendConfirmation)
- This history is stored durably in Temporal DB.

#### Worker crashes

- Workflow was waiting for SendConfirmation
- Worker pod is gone
- Memory = lost

#### New worker picks it up (Replay)

- Temporal gives the entire history to the new worker.
Worker:
  - Starts executing workflow from line 1

But now…

#### Replay behavior (This is the magic)

- workflow.ExecuteActivity(ChargePayment)
- Temporal sees in history:
- ActivityCompleted(ChargePayment)
- So it does not schedule it again.
Instead:

- Returns cached result
- Continues execution
- Same for every step.

#### Workflow continues safely

- workflow.ExecuteActivity(SendConfirmation)
- This one was not completed yet → scheduled again.

- Payment not double-charged
- Workflow resumes correctly
- No state lost
